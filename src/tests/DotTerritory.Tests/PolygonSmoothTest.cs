using NetTopologySuite.Geometries;

namespace DotTerritory.Tests;

public class PolygonSmoothTest
{
    [Fact]
    public void SmoothPolygon()
    {
        /*
         var polygon = turf.polygon([
             [
               [11, 0],
               [22, 4],
               [31, 0],
               [31, 11],
               [21, 15],
               [11, 11],
               [11, 0],
             ],
           ]);

           var smoothed = turf.polygonSmooth(polygon, { iterations: 3 });
           
           // output:
           [
             [
               [ 15.8125, 1.75 ],       [ 17.1875, 2.25 ],
               [ 18.53125, 2.625 ],     [ 19.84375, 2.875 ],
               [ 21.125, 3 ],           [ 22.375, 3 ],
               [ 23.59375, 2.875 ],     [ 24.78125, 2.625 ],
               [ 25.9375, 2.25 ],       [ 27.0625, 1.75 ],
               [ 28.046875, 1.484375 ], [ 28.890625, 1.453125 ],
               [ 29.59375, 1.65625 ],   [ 30.15625, 2.09375 ],
               [ 30.578125, 2.765625 ], [ 30.859375, 3.671875 ],
               [ 31, 4.8125 ],          [ 31, 6.1875 ],
               [ 30.84375, 7.453125 ],  [ 30.53125, 8.609375 ],
               [ 30.0625, 9.65625 ],    [ 29.4375, 10.59375 ],
               [ 28.65625, 11.421875 ], [ 27.71875, 12.140625 ],
               [ 26.625, 12.75 ],       [ 25.375, 13.25 ],
               [ 24.125, 13.625 ],      [ 22.875, 13.875 ],
               [ 21.625, 14 ],          [ 20.375, 14 ],
               [ 19.125, 13.875 ],      [ 17.875, 13.625 ],
               [ 16.625, 13.25 ],       [ 15.375, 12.75 ],
               [ 14.28125, 12.140625 ], [ 13.34375, 11.421875 ],
               [ 12.5625, 10.59375 ],   [ 11.9375, 9.65625 ],
               [ 11.46875, 8.609375 ],  [ 11.15625, 7.453125 ],
               [ 11, 6.1875 ],          [ 11, 4.8125 ],
               [ 11.171875, 3.671875 ], [ 11.515625, 2.765625 ],
               [ 12.03125, 2.09375 ],   [ 12.71875, 1.65625 ],
               [ 13.578125, 1.453125 ], [ 14.609375, 1.484375 ],
               [ 15.8125, 1.75 ],
             ]
           ]
        */

        var polygon = new Polygon(
            new LinearRing(
                [
                    new Coordinate(11, 0),
                    new Coordinate(22, 4),
                    new Coordinate(31, 0),
                    new Coordinate(31, 11),
                    new Coordinate(21, 15),
                    new Coordinate(11, 11),
                    new Coordinate(11, 0),
                ]
            )
        );

        var smoothed = Territory.Smooth(polygon, 3);

        double[][][] expected =
        [
            [
                [15.8125, 1.75],
                [17.1875, 2.25],
                [18.53125, 2.625],
                [19.84375, 2.875],
                [21.125, 3],
                [22.375, 3],
                [23.59375, 2.875],
                [24.78125, 2.625],
                [25.9375, 2.25],
                [27.0625, 1.75],
                [28.046875, 1.484375],
                [28.890625, 1.453125],
                [29.59375, 1.65625],
                [30.15625, 2.09375],
                [30.578125, 2.765625],
                [30.859375, 3.671875],
                [31, 4.8125],
                [31, 6.1875],
                [30.84375, 7.453125],
                [30.53125, 8.609375],
                [30.0625, 9.65625],
                [29.4375, 10.59375],
                [28.65625, 11.421875],
                [27.71875, 12.140625],
                [26.625, 12.75],
                [25.375, 13.25],
                [24.125, 13.625],
                [22.875, 13.875],
                [21.625, 14],
                [20.375, 14],
                [19.125, 13.875],
                [17.875, 13.625],
                [16.625, 13.25],
                [15.375, 12.75],
                [14.28125, 12.140625],
                [13.34375, 11.421875],
                [12.5625, 10.59375],
                [11.9375, 9.65625],
                [11.46875, 8.609375],
                [11.15625, 7.453125],
                [11, 6.1875],
                [11, 4.8125],
                [11.171875, 3.671875],
                [11.515625, 2.765625],
                [12.03125, 2.09375],
                [12.71875, 1.65625],
                [13.578125, 1.453125],
                [14.609375, 1.484375],
                [15.8125, 1.75],
            ],
        ];

        LineString[] rings = [smoothed.ExteriorRing, .. smoothed.InteriorRings];

        for (var i = 0; i < rings.Length; i++)
        {
            for (var j = 0; j < rings[i].NumPoints; j++)
            {
                var coordinate = rings[i].GetCoordinateN(j);

                coordinate.X.ShouldBe(expected[i][j][0], tolerance: 6);
                coordinate.Y.ShouldBe(expected[i][j][1], tolerance: 6);
            }
        }
    }
}
